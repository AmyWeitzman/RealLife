{% extends "base.html" %}

{% block content %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/expenses.css') }}">
    <table>
        <tr><th id="table-title" colspan="6">ANNUAL FINANCIAL REPORT</th></tr>
        <tr>
            <th>Type</th>
            <th>Details</th>
            <th>Cost</th>
            <th class="total-col">Total</th>
            <th class="test" id="test-title">Test</th>
        </tr>
        <tr>
            <td class="type">Job Stress</td>
            <td class="details">
                <ul>
                    <li>based on income</li>
                    <li>higher paying jobs are more stressful</li>
                </ul>
            </td>
            <td>
                {% if player_info.path == "military" %}
                <p>minus (current salary / 1000) points</p>
                {% else %}
                <p>minus (base salary / 1000) points</p>
                {% endif %}
            </td>
            <td class="amount">-<span id="job-stress">{{ "{:,.0f}".format(job_stress) }}</span> points</td>

            <td class="blank test" rowspan="5">
                <form action="{{ url_for('test_expenses') }}">
                    <label for="job"><b>Job:</b></label>
                    <select name="job" id="job" class="dropdown">
                        <option value="{{ player_info.job }}">{{ player_info.job }}</option>
                        {% for job in jobs %}
                        <option value="{{ job.title }}" class="{{ job.category }}">{{ job.title }}</option>
                        {% endfor %}
                    </select><br>

                    <label for="house"><b>House:</b></label>
                    <select name="house" id="house" class="dropdown" onchange="updateTestOptions()">
                        <option value="{{ player_info.house }}">{{ player_info.house }}</option>
                        {% for house in houses %}
                        <option value="{{ house.name }}" class="{{ house.category }}">{{ house.name }}</option>
                        {% endfor %}
                    </select><br>
                    {% if player_info.house == "None" or house_category == 'no-family' %}
                        <input type="checkbox" name="test-home-ins" class="checkbox" value="test-home-ins" id="test-home-ins-checkbox" disabled>
                    {% elif player_info.have_home_ins %}
                        <input type="checkbox" name="test-home-ins" class="checkbox" value="test-home-ins" id="test-home-ins-checkbox" checked>
                    {% else %}
                        <input type="checkbox" name="test-home-ins" class="checkbox" value="test-home-ins" id="test-home-ins-checkbox">
                    {% endif %}
                        <label for="test-home-ins" class="once">w/ home insurance</label><br>

                    <label for="car"><b>Vehicle:</b></label>
                    <select name="car" id="car" class="dropdown" onchange="updateTestOptions()">
                        <option value="{{ player_info.car }}">{{ player_info.car }}</option>
                        {% for car in cars %}
                        <option value="{{ car.name }}" class="{{ car.category }}">{{ car.name }}</option>
                        {% endfor %}
                    </select><br>
                    {% if player_info.car == "None" or car_category == 'no-family' %}
                        <input type="checkbox" name="test-auto-ins" class="checkbox" value="test-auto-ins" id=test-auto-ins-checkbox disabled>
                    {% elif player_info.have_auto_ins %}
                        <input type="checkbox" name="test-auto-ins" class="checkbox" value="test-auto-ins" id=test-auto-ins-checkbox checked>
                    {% else %}
                        <input type="checkbox" name="test-auto-ins" class="checkbox" value="test-auto-ins" id=test-auto-ins-checkbox>
                    {% endif %}
                        <label for="test-auto-ins" class="once">w/ auto insurance</label><br>

                    <input type="checkbox" name="test-health-ins" class="checkbox" value="test-health-ins" id="test-health-ins-checkbox">
                    <label for="test-health-ins"><b>Health insurance?</b></label><br>

                    <input type="checkbox" name="test-married" class="checkbox" value="test-married" id="test-married-checkbox">
                    <label for="test-married"><b>Married?</b></label><br>

                    <p><b>Have child:</b></p>
                    <input type="radio" name="test-kids" value="test-kids-none" checked>
                    <label for="test-kids-none" class="left-radio">0</label>
                    <input type="radio" name="test-kids" value="test-single-child">
                    <label for="test-single-child" class="left-radio">1</label>
                    <input type="radio" name="test-kids" value="test-twins">
                    <label for="test-twins" class="left-radio">2</label><br>

                    <label for="test-loan"><b>Loan:</b></label><br>
                    <b id="dollar-sign">$</b> <input type="text" class="textbox" name="test-loans-amount"><br>

                    {% if my_benefits %}
                    <input type="checkbox" name="test-benefits" class="checkbox" value="test-benefits" id="test-benefits-checkbox" checked>
                    <label for="test-benefits"><b>Military Benefits?</b></label><br>
                    {% else %}
                    <input type="checkbox" name="test-benefits" class="checkbox" value="test-benefits" id="test-benefits-checkbox" style="visibility: hidden;">
                    <label for="test-benefits" style="visibility: hidden;"><b>Military Benefits?</b></label><br>
                    {% endif %}

                    <button type="submit" id="start-test-button">TEST</button>
                </form>
            </td>
        </tr>
        <tr>
            <td class="type">House Quality</td>
            <td class="details">
                <ul>
                    <li>based on house cost</li>
                </ul>
            </td>
            <td>
                <span class="italic">see houses chart</span>
            </td>
            <td class="amount">-<span id="house-stress">{{ "{:,.0f}".format(house_stress) }}</span> points</td>
        </tr>
        <tr>
            <td class="type">Taxes</td>
            <td class="details">
                <ul>
                    <li>based on income level</li>
                </ul>
            </td>
            <td>
                <p id="tax-0">income <= $20,000: no taxes</p>
                <p id="tax-10">income < $40,000: 10%</p>
                <p id="tax-20">income < $80,000: 20%</p>
                <p id="tax-30">income < $200,000: 30%</p>
                <p id="tax-40">income >= $200,000: 40%</p>
                {% if player_info.married %}
                <p class="once">* 50% off since married</p>
                {% endif %}
            </td>
            <td class="amount">$-<span id="taxes">{{ "{:,.0f}".format(taxes) }}</span></td>
        </tr>
        <tr>
            <td class="type">Insurance</td>
            <td class="details">
                <ul>
                    <li><b>auto:</b> covers car accident (except chiropractor)</li>
                    <li><b>health:</b> covers major medical problems, chiropractor, psychologist</li>
                    <span class="once">*NOTE: covered by parents until turn 26</span>
                    <li><b>home:</b> covers earthquake, fire damage</li>
                </ul>
            </td>
            <td>
                <p><b>auto:</b><span class="italic"> see vehicles chart</span></p>
                {% if player_info.job == "Mechanic" %}
                <p  class="once">* Free auto insurance for mechanic</p>
                {% endif %}
                <p><b>health:</b> $500 per person</p>
                {% if player_info.age < 26 %}
                <p class="once">* Still covered by parents' health insurance</p>
                {% endif %}
                {% if my_benefits %}
                <p class="once">* Free health insurance through military benefits</p>
                {% endif %}
                {% if player_info.job == "Doctor" %}
                <p  class="once">* Doctor gets 10% off health insurance</p>
                {% endif %}
                <p><b>home:</b><span class="italic"> see houses chart</span></p>
                {% if player_info.job == "Firefighter" %}
                <p  class="once">* Free home insurance for firefighter</p>
                {% endif %}
                </ul>
            </td>
            <td class="amount">
                <p><b>auto:</b> $-<span id="auto-ins-val">{{ '{:,.0f}'.format(auto_ins) }}</span></p>
                <p><b>health:</b> $-<span id="health-ins-val">{{ '{:,.0f}'.format(health_ins) }}</span></p>
                <p><b>home:</b> $-<span id="home-ins-val">{{ '{:,.0f}'.format(home_ins) }}</span></p>
            </td>
        </tr>
        <tr>
            <td class="type">Shopping</td>
            <td class="details">
                <ul>
                    <li>groceries, essentials</li>
                </ul>
            </td>
            <td>
                <p>$1000 per person</p>
                {% if player_info.path == "college" %}
                <p class="once">* college students get 50% off</p>
                {% endif %}
            </td>
            <td class="amount">$-<span id="shopping">{{ '{:,.0f}'.format(shopping) }}</span></td>
        </tr>
        <tr>
            <td class="type">Car Maintenance</td>
            <td class="details">
                <ul>
                    <li>only applicable if have small/large family vehicle</li>
                </ul>
            </td>
            <td>
                <p>$100</p>
                {% if player_info.job == "Mechanic" %}
                <p class="once">* free for mechanic</p>
                {% endif %}
            </td>
            <td class="amount">$-<span id="car-maintain">{{ '{:,.0f}'.format(car_maintenance) }}</span></td>
        </tr>
        <tr>
            <td class="type">Maid Service</td>
            <td class="details">
                <ul>
                    <li>only applicable if have house</li>
                </ul>
            </td>
            <td> 
                <span class="italic">see houses chart</span>  
                {%  if player_info.was_janitor %}
                <p class="once">* learned cleaning skills as janitor don't need to hire maid</p>
                {% endif %}
            </td>
            <td class="amount">$-<span id="maid">{{ '{:,.0f}'.format(maid) }}</span></td>
        </tr>
        <tr>
            <td class="type">Utilities</td>
            <td class="details">
                <ul>
                    <li>only applicable if have house</li>
                </ul>
            </td>
            <td>
                <p>$50 + 10% cost of house</p>
                {% if player_info.job in ["Plumber", "Electrician"] %}
                <p class="once">* {{ player_info.job }} gets 50% off</p>
                {% endif %}
            </td>
            <td class="amount">$-<span id="utils">{{ '{:,.0f}'.format(utilities) }}</span></td>
        </tr>
        <tr>
            <td class="type">Dental Fees</td>
            <td class="details">
            </td>
            <td>
                <p>$10 per person</p>
                {% if player_info.job == "Dentist" %}
                <p class="once">* Dentist does not pay dental fees</p>
                {% endif %}
            </td>
            <td class="amount">$-<span id="dental">{{ '{:,.0f}'.format(dental_fees) }}</span></td>
        </tr>
        <tr>
            <td class="type">Eat-out / Entertainment</td>
            <td class="details">
            </td>
            <td>
                <p id="sal-50">salary < $50,000: 1% of salary</p>
                <p id="sal-100">salary < $100,000: 5% of salary</p>
                <p id="sal-101">salary >= $100,000: 10% of salary</p>
                {% if player_info.job in ["Military", "Cashier", "Barista"] %}
                    <p class="once">* {{ player_info.job }} gets 50% off</p>
                {% endif %}
                {% if player_info.path != "military" and my_benefits %}
                    <p class="once">* military benefits: 50% off</p>
                {% endif %}
            </td>
            <td class="amount">$-<span id="eat-ent">{{ '{:,.0f}'.format(eat_ent) }}</span></td>
            <td class="blank">
                <!-- <p class="cur-status"><b>Current $$$:</b> {{ '{:,.0f}'.format(player_info.money) }}</p>
                <p class="cur-status"><b>Current Points:</b> {{ '{:,.0f}'.format(player_info.points) }}</p> -->
            </td>
        </tr>
        <tr>
            <td class="type">Gas</td>
            <td class="details">
                <ul>
                    <li>only applicable if have small/large family vehicle</li>
                </ul>
            </td>
            <td> 
                <span class="italic">see vehicles chart</span>  
                {% if player_info.job == "Truck Driver" %}
                <p class="once">* free for truck driver</p>
                {% endif %}
            </td>
            <td class="amount">$-<span id="gas">{{ '{:,.0f}'.format(gas) }}</span></td>
        </tr>
        <tr>
            <td class="type">Tax Prep Fee</td>
            <td class="details">
            </td>
            <td> 
                <span>$100</span>  
                {% if player_info.job == "Accountant" %}
                <p class="once">* free for accountant</p>
                {% endif %}
            </td>
            <td class="amount">$-<span id="tax-prep">{{ '{:,.0f}'.format(tax_prep) }}</span></td>
        </tr>
        <tr>
            <td class="type">Miscellaneous Points</td>
            <td class="details">
                {% if player_info.buying_organic %}
                <p>Buy organic: get 50 points per person</p>
                {% endif %}
                {% if player_info.depressed %}
                <p>Depression: gain 10% of points back</p>
                {% endif %}
                {% if my_loans > 0 %}
                <p>Loans: lose (loans / 10,000) points</p>
                {% endif %}
            </td>
            <td>
                {% if player_info.buying_organic %}
                <p class="gain">Buy organic: +{{ "{:,.0f}".format(50 * num_people) }} points</p>
                {% endif %}
                {% if player_info.have_pet %}
                <p class="gain">Pet: +10 points</p>
                {% endif %}
                {% if player_info.have_pool %}
                <p class="gain">Pool: +250 points</p>
                {% endif %}
                {% if player_info.depressed %}
                <p class="gain">Depression: +{{ "{:,.0f}".format(depression_pts) }} points</p>
                {% endif %}
                {% if my_job == "Teacher" and player_info.current_salary < 100000 %}
                <p class="gain">Teacher Appreciation: +100 points</p>
                {% endif %}
                {% if my_path == "college" and my_job != "None" %}
                <p class="loss">College Job Stress: -50 points</p>
                {% endif %}
                {% if my_loans > 0 %}
                <p class="loss">Loans: -{{ "{:,.0f}".format(loan_pts) }} points</p>
                {% endif %}
            </td>
            <td class="amount"><span id="misc-points">{{ '{:,.0f}'.format(misc_points) }} points</span></td>
        </tr>
        <tr>
            <td class="type">Miscellaneous $$$</td>
            <td class="details">
                {% if rent != 0 %}
                <p>Rent: Single person houses are for annual rent</p>
                {% endif %}
                {% if my_car == "Public Transit" %}
                <p>Public Transit: cost is annual fee</p>
                {% endif %}
                {% if player_info.buying_organic %}
                <p>Buy organic: extra $1000 per person</p>
                {% endif %}
                {% if player_info.buying_organic and my_job == "Farmer" %}
                <p>* Buy organic: farmer gets 25% off</p>
                {% endif %}
                {% if player_info.have_pet and my_job == "Veterinarian" %}
                <p>* Veterinarian does not pay pet fees</p>
                {% endif %}
                {% if player_info.depressed and not player_info.job == "Psychologist" %}
                <p>Depression: $1000 fee to psychologist for treatment</p>
                {% endif %}
                {% if my_loans > 0 %}
                <p>Loans: automatically pay back 0.5% of loans</p>
                {% endif %}
                {% if my_job == "Accountant" %}
                <p>Accountant collects all tax prep fees</p>
                {% endif %}
                {% if my_job == "Waiter" %}
                <p>Waiter gets $2000 in tips</p>
                {% endif %}
                {% if my_job == "Dentist" %}
                <p>Dentist collects all dental fees</p>
                {% endif %}
                {% if my_job == "Veterinarian" %}
                <p>Veterinarian collects all pet fees</p>
                {% endif %}
                {% if my_job == "Psychologist" %}
                <p>Psychologist collects all depression fees</p>
                {% endif %}
                {% if my_job == "Athlete" and player_info.med_prob %}
                <p class="once">* Athlete had medical problem, only gets paid 1/4 of salary</p>
                {% endif %}
                {% if player_info.cur_time_til_raise == 1 and my_path != "military" and my_job != "YouTuber" and not (my_job == "Teacher" and player_info.num_yrs_teacher == 14) %}
                <p>Getting a $1000 raise this year</p>
                {% endif %}
                {% if player_info.cur_time_til_raise == 1 and my_path == "military" %}
                <p>Salary doubles this year</p>
                {% endif %}
                {% if my_job == "Teacher" and player_info.num_yrs_teacher == 14 %}
                <p>Teacher promoted to Principal</p>
                {% endif %}
            </td>
            <td>
                {% if rent != 0 %}
                <p class="loss">Rent: ${{ "{:,.0f}".format(rent) }}</p>
                {% endif %}
                {% if my_car == "Public Transit" %}
                <p class="loss">Public Transit: ${{ "{:,.0f}".format(transit_fee) }}</p>
                {% endif %}
                {% if player_info.buying_organic %}
                <p class="loss">Buy organic: ${{ "{:,.0f}".format(1000 * num_people) }}</p>
                {% endif %}
                {% if player_info.have_pet and player_info.job != "Veterinarian" %}
                <p class="loss">Pet: $100</p>
                {% endif %}
                {% if player_info.have_pool %}
                <p class="loss">Pool: $20,000</p>
                {% endif %}
                {% if player_info.depressed and not player_info.job == "Psychologist" %}
                <p class="loss">Depression: $1000</p>
                {% endif %}
                {% if my_loans > 0 %}
                <p class="loss">Loans: ${{ "{:,.0f}".format(mandatory_loans) }}</p>
                {% endif %}
                {% if my_job == "Accountant" %}
                <p class="gain">Tax prep: ${{ all_tax_prep_fees }}</p>
                {% endif %}
                {% if my_job == "Waiter" %}
                <p class="gain">Waiter tips: $2000</p>
                {% endif %}
                {% if my_job == "Dentist" %}
                <p class="gain">Dental fees: ${{ all_dental_fees }}</p>
                {% endif %}
                {% if my_job == "Veterinarian" %}
                <p class="gain">Pet fees: ${{ all_pet_fees }}</p>
                {% endif %}
                {% if my_job == "Psychologist" %}
                <p class="gain">Depression fees: ${{ all_depression_fees }}</p>
                {% endif %}
                {% if player_info.cur_time_til_raise == 1 and my_path != "military" and my_job != "YouTuber" and not (my_job == "Teacher" and player_info.num_yrs_teacher == 14) %}
                <p class="gain">Raise: $1000</p>
                {% endif %}
                {% if player_info.cur_time_til_raise == 1 and my_path == "military" %}
                <p class="gain">Raise: salary -> ${{ '{:,.0f}'.format(player_info.current_salary * 2) }}</p>
                {% endif %}
                {% if my_job == "Teacher" and player_info.num_yrs_teacher == 14 %}
                <p>Raise: salary -> $100,000</p>
                {% endif %}
            </td>
            <td class="amount">$<span id="misc-fees">{{ '{:,.0f}'.format(-1 * misc_fees) }}</span></td>
        </tr>
        <tr>
            <td class="type tax-break">Tax Break</td>
            <td class="details">
            </td>
            <td>
                <p>$500 per child until child turns 18</p>
            </td>
            <td class="amount tax-break">$<span id="tax-break-val">{{ '{:,.0f}'.format(tax_break) }}</span></td>
        </tr>
        <tr>
            <td class="last-row" colspan="5">
            <form id="results-form" action="{{ url_for('end_of_year') }}">
                <p class="loans-bg input-label"><b>Loans + Interest</b></p>
                <p class="in-line loans-cur-val">${{ '{:,.0f}'.format(loans_int - mandatory_loans) }}</p>
                {% if my_loans == 0 %}
                    <b class="last-dollar-sign in-line">$</b> <input type="text" class="textbox in-line loans-bg" name="loans-amount" id="pay-loans" value="0" readonly>
                {% else %}
                    <b class="last-dollar-sign in-line">$</b> <input type="text" class="textbox in-line loans-bg" name="loans-amount" id="pay-loans" onchange="updateExpenses()">
                {% endif %}
                <!-- <label for="pay-loans" class="in-line checkbox-label {{ 'short-margin' if player_info.age == 25 and not my_benefits else ''}}" >${{ '{:,.0f}'.format(new_health_ins) }}</label> -->
                {% if player_info.loans > 0 %}
                <label class="in-line" id='can-afford'>Can Afford: $<span id="loans-afford"></span></label>
                {% endif %}
                
                <p class="auto-ins-bg input-label pad-bottom" data-toggle="tooltip" data-html="true" title="Covers: <br>-Car accidents"><b>Auto Insurance </b></p>
                {% if no_fam_car %}
                    <input type="checkbox" name="auto-ins" class="ins-checkbox in-line" value="auto-ins" id="new-auto-ins" disabled>
                    <label for="auto-ins" class="in-line checkbox-label">${{ '{:,.0f}'.format(new_auto_ins) }}</label>
                {% elif (player_info.yrs_til_change_car != 3) and (player_info.have_auto_ins) %}
                    <input type="checkbox" name="auto-ins" class="ins-checkbox in-line" value="auto-ins" id="new-auto-ins" checked>
                    <label for="auto-ins" class="in-line checkbox-label">${{ '{:,.0f}'.format(car.insurance) }}</label>
                {% elif player_info.yrs_til_change_car == 3 %}
                    <input type="checkbox" name="auto-ins" class="ins-checkbox in-line" value="auto-ins" id="new-auto-ins">
                    <label for="auto-ins" class="in-line checkbox-label short-margin">${{ '{:,.0f}'.format(new_auto_ins) }}</label>    
                    <label class="in-line once" class="ins-notice">New car: get insurance if desired</label>
                {% else %}
                    <input type="checkbox" name="auto-ins" class="ins-checkbox in-line" value="auto-ins" id="new-auto-ins">
                    <label for="auto-ins" class="in-line checkbox-label">${{ '{:,.0f}'.format(car.insurance) }}</label>
                {% endif %}
            
                <p class="health-ins-bg input-label pad-bottom" data-toggle="tooltip" data-html="true" title="Covers: <br>-Major medical problems<br>-Chiropractor<br>-Psychologist (<del>depression</del>)"><b>Health Insurance </b></p>
                {% if player_info.age < 25 and my_benefits and not benefits_run_out %}
                    <input type="checkbox" name="health-ins" class="ins-checkbox in-line" value="health-ins" id="new-health-ins" disabled checked>
                {% elif player_info.age == 25 and not my_benefits %}
                <input type="checkbox" name="health-ins" class="ins-checkbox in-line" value="health-ins" id="new-health-ins">
                {% elif player_info.have_health_ins %}
                <input type="checkbox" name="health-ins" class="ins-checkbox in-line" value="health-ins" id="new-health-ins" checked>
                {% else %}
                    <input type="checkbox" name="health-ins" class="ins-checkbox in-line" value="health-ins" id="new-health-ins">
                {% endif %}
                <label for="health-ins" class="in-line checkbox-label {{ 'short-margin' if player_info.age == 25 and not my_benefits else ''}}" >${{ '{:,.0f}'.format(new_health_ins) }}</label>
                {% if player_info.age == 25 and not my_benefits %}
                <label class="in-line once" class="ins-notice">Not covered by parents</label>
                {% endif %}

                <p class="home-ins-bg input-label pad-bottom" data-toggle="tooltip" data-html="true" title="Covers: <br>-Earthquake damage<br>-Fire damage"><b>Home Insurance </b></p>
                {% if no_fam_house %}
                    <input type="checkbox" name="home-ins" class="ins-checkbox in-line" value="home-ins" id="new-home-ins" disabled>
                    <label for="home-ins" class="in-line checkbox-label">${{ '{:,.0f}'.format(new_home_ins) }}</label>
                {% elif (player_info.yrs_til_change_house != 3) and (player_info.have_home_ins) %}
                    <input type="checkbox" name="home-ins" class="ins-checkbox in-line" value="home-ins" id="new-home-ins" checked>
                    <label for="home-ins" class="in-line checkbox-label">${{ '{:,.0f}'.format(house.insurance) }}</label>
                {% elif player_info.yrs_til_change_house == 3 %}
                    <input type="checkbox" name="home-ins" class="ins-checkbox in-line" value="home-ins" id="new-home-ins">
                    <label for="home-ins" class="in-line checkbox-label short-margin">${{ '{:,.0f}'.format(new_home_ins) }}</label>
                    <label class="in-line once" class="ins-notice">New house: get insurance if desired</label>
                {% else %}
                    <input type="checkbox" name="home-ins" class="ins-checkbox in-line" value="home-ins" id="new-home-ins">
                    <label for="home-ins" class="in-line checkbox-label">${{ '{:,.0f}'.format(house.insurance) }}</label>
                {% endif %}
                <!-- <label for="home-ins" class="in-line checkbox-label">${{ '{:,.0f}'.format(new_home_ins) }}</label> -->
                
                <p id="net-points" class="in-line top-margin"><b>NET POINTS: </b></p>
                <input id="net-points-val" name="net-points" class="top-margin" readonly>
                <p id="total-expenses-label" class="in-line top-margin"><b>TOTAL EXPENSES: </b></p>
                <p class='last-dollar-sign total-dollar-sign'>$</p>
                <input id="total-expenses" name="total-expenses" readonly>
                {% if not testing %}
                <button type="submit" id="pay-button" class="in-line top-margin" value="pay" name="btn">PAY</button>
                {% else %}
                <button type="submit" id="done-button" class="in-line top-margin" value="done" name="btn">DONE</button>
                {% endif %}
            </form>
            </td>
        </tr>
        <tr>
            <td class="last-row net-row" colspan="5">
                <p id="net-calc">salary - expenses + miscellaneous earnings = </p>
                <p id="net-earnings" class="in-line top-margin"><b>NET EARNINGS: </b></p>
                <p class="last-dollar-sign total-dollar-sign" id="net-dollar-sign">$</p>
                <input id="net-earnings-val" class="top-margin" readonly>
            </td>
        </tr>
    </table>
    <script type="text/javascript">
            money = parseFloat("{{ player_info.money }}");
            salary = parseFloat("{{ my_cur_salary }}");
            ttraise = parseFloat("{{ player_info.cur_time_til_raise }}");
            path = "{{ my_path }}";
            job = "{{ my_job }}";
            real_loans = parseFloat("{{ loans_int }}");
            mandatory_loans = parseFloat("{{ mandatory_loans }}");

            if(job == "Teacher")
                num_yrs_teacher = parseFloat("{{ player_info.num_yrs_teacher }}");
            if((ttraise == 1) && (path != "military") && (job != "YouTuber") && !(job == "Teacher" && num_yrs_teacher == 14))
                salary += 1000;  // getting $1000 raise
            else if((ttraise == 1) && (path == "military"))
                salary *= 2;  // salary doubles for raise
            else if((job == "Teacher") && (num_yrs_teacher == 14))
                salary = 100000

            if(job == "Athlete") {
                med_prob = "{{ player_info.med_prob }}";
                if(med_prob.toLowerCase() == "true")
                    salary *= 0.25  // athlete only get 1/4 of salary if injured
            }

            is_loan_error = false;

            // Money
            taxes = parseFloat(document.getElementById("taxes").innerHTML.replace(/,/g, ''));
            auto_ins = parseFloat(document.getElementById("auto-ins-val").innerHTML.replace(/,/g, ''));
            health_ins = parseFloat(document.getElementById("health-ins-val").innerHTML.replace(/,/g, ''));
            home_ins = parseFloat(document.getElementById("home-ins-val").innerHTML.replace(/,/g, ''));
            shopping = parseFloat(document.getElementById("shopping").innerHTML.replace(/,/g, ''));
            car_maintain = parseFloat(document.getElementById("car-maintain").innerHTML.replace(/,/g, ''));
            maid = parseFloat(document.getElementById("maid").innerHTML.replace(/,/g, ''));
            utils = parseFloat(document.getElementById("utils").innerHTML.replace(/,/g, ''));
            dental = parseFloat(document.getElementById("dental").innerHTML.replace(/,/g, ''));
            eat_ent = parseFloat(document.getElementById("eat-ent").innerHTML.replace(/,/g, ''));
            gas = parseFloat(document.getElementById("gas").innerHTML.replace(/,/g, ''));
            misc_fees = -1 * parseFloat(document.getElementById("misc-fees").innerHTML.replace(/,/g, ''));
            tax_prep = parseFloat(document.getElementById("tax-prep").innerHTML.replace(/,/g, ''));
            tax_break = parseFloat(document.getElementById("tax-break-val").innerHTML.replace(/,/g, ''));
            loans_payment = parseFloat(document.getElementById("pay-loans").value.replace(/,/g, ''));
            //salary -= misc_fees;

            // do not want expenses calculated with NaN, cannot pay more than current money for total loan payments
            if(isNaN(loans_payment))
                loans_payment = 0;
            if(loans_payment > (real_loans - mandatory_loans)) {
                loanPaymentError();  // cannot pay more than you owe for loans
                is_loan_error = true;
            }
            else {
                is_loan_error = false;
            }

            expenses = taxes + auto_ins + health_ins + home_ins + shopping + car_maintain + maid + utils + dental + eat_ent + gas + misc_fees + tax_prep - tax_break + loans_payment;
        
            // Points
            job_stress = parseFloat(document.getElementById("job-stress").innerHTML);
            house_stress = parseFloat(document.getElementById("house-stress").innerHTML);
            misc_points = parseFloat(document.getElementById("misc-points").innerHTML);
            net_points = misc_points - job_stress - house_stress;

            net_earnings = salary - expenses;

            document.getElementById("net-points-val").value = parseFloat(net_points).toLocaleString('en');
            document.getElementById("total-expenses").value = parseFloat(expenses).toLocaleString('en');
            document.getElementById("net-earnings-val").value = parseFloat(net_earnings).toLocaleString('en');

            amt_can_afford = Math.min(Math.floor(net_earnings + money + loans_payment), Math.floor(real_loans - mandatory_loans))
            if(real_loans - mandatory_loans > 0)
                document.getElementById('loans-afford').innerHTML = parseFloat(amt_can_afford > 0 ? amt_can_afford : 0).toLocaleString('en');

            income = parseFloat("{{ player_info.current_salary }}");
            job = "{{ my_job }}";
            if(job == "Athlete")
                income *= 0.25

            if(income <= 20000)
                document.getElementById("tax-0").setAttribute('style', 'font-weight: bold;');
            else if(income < 40000)
                document.getElementById("tax-10").setAttribute('style', 'font-weight: bold;');
            else if(income < 80000)
                document.getElementById("tax-20").setAttribute('style', 'font-weight: bold;');
            else if(income < 200000)
                document.getElementById("tax-30").setAttribute('style', 'font-weight: bold;');
            else
                document.getElementById("tax-40").setAttribute('style', 'font-weight: bold;');

            if(income < 50000)
                document.getElementById("sal-50").setAttribute('style', 'font-weight: bold;');
            else if(income < 100000)
                document.getElementById("sal-100").setAttribute('style', 'font-weight: bold;');
            else
                document.getElementById("sal-101").setAttribute('style', 'font-weight: bold;');

            if(loans_payment == 0)
                noLoanPaymentError();  // no error if not paying back any loan
            else if((money + net_earnings <= 0) || ((money + net_earnings > 0) && (loans_payment > 0) && (expenses > (money + net_earnings)) && (loans_payment > (money + net_earnings + loans_payment)))) {
                loanPaymentError();    // error if paying more than current money
            }
            else if(is_loan_error)
                loanPaymentError(); 
            else {
                noLoanPaymentError();
            }

            function updateExpenses() {
                taxes = parseFloat(document.getElementById("taxes").innerHTML.replace(/,/g, ''));
                auto_ins = parseFloat(document.getElementById("auto-ins-val").innerHTML.replace(/,/g, ''));
                health_ins = parseFloat(document.getElementById("health-ins-val").innerHTML.replace(/,/g, ''));
                home_ins = parseFloat(document.getElementById("home-ins-val").innerHTML.replace(/,/g, ''));
                shopping = parseFloat(document.getElementById("shopping").innerHTML.replace(/,/g, ''));
                car_maintain = parseFloat(document.getElementById("car-maintain").innerHTML.replace(/,/g, ''));
                maid = parseFloat(document.getElementById("maid").innerHTML.replace(/,/g, ''));
                utils = parseFloat(document.getElementById("utils").innerHTML.replace(/,/g, ''));
                dental = parseFloat(document.getElementById("dental").innerHTML.replace(/,/g, ''));
                eat_ent = parseFloat(document.getElementById("eat-ent").innerHTML.replace(/,/g, ''));
                gas = parseFloat(document.getElementById("gas").innerHTML.replace(/,/g, ''));
                misc_fees = -1 * parseFloat(document.getElementById("misc-fees").innerHTML.replace(/,/g, ''));
                tax_prep = parseFloat(document.getElementById("tax-prep").innerHTML.replace(/,/g, ''));
                tax_break = parseFloat(document.getElementById("tax-break-val").innerHTML.replace(/,/g, ''));
                loans_payment = parseFloat(document.getElementById("pay-loans").value.replace(/,/g, ''));
                // salary -= misc_fees;

                // do not want expenses calculated with NaN
                if(isNaN(loans_payment))
                    loans_payment = 0;
                if(loans_payment > (real_loans - mandatory_loans)) {
                    loanPaymentError();  // cannot pay more than you owe for loans
                    is_loan_error = true;
                }
                else {
                    is_loan_error = false;
                }
    
                expenses = taxes + auto_ins + health_ins + home_ins + shopping + car_maintain + maid + utils + dental + eat_ent + gas + misc_fees + tax_prep - tax_break + loans_payment;
                net_earnings = salary - expenses;
                
                document.getElementById("total-expenses").value = parseFloat(expenses).toLocaleString('en');
                document.getElementById("net-earnings-val").value = parseFloat(net_earnings).toLocaleString('en');
            
                income = parseFloat("{{ player_info.current_salary }}");
                job = "{{ my_job }}";
                if(job == "Athlete")
                    income *= 0.25

                if(income <= 20000)
                    document.getElementById("tax-0").setAttribute('style', 'font-weight: bold;');
                else if(income < 40000)
                    document.getElementById("tax-10").setAttribute('style', 'font-weight: bold;');
                else if(income < 80000)
                    document.getElementById("tax-20").setAttribute('style', 'font-weight: bold;');
                else if(income < 200000)
                    document.getElementById("tax-30").setAttribute('style', 'font-weight: bold;');
                else
                    document.getElementById("tax-40").setAttribute('style', 'font-weight: bold;');

                if(income < 50000)
                    document.getElementById("sal-50").setAttribute('style', 'font-weight: bold;');
                else if(income < 100000)
                    document.getElementById("sal-100").setAttribute('style', 'font-weight: bold;');
                else
                    document.getElementById("sal-101").setAttribute('style', 'font-weight: bold;');

                if(loans_payment == 0)
                    noLoanPaymentError();
                else if((money + net_earnings <= 0) || ((money + net_earnings > 0) && (loans_payment > 0) && (expenses > (money + net_earnings)) && (loans_payment > (money + net_earnings + loans_payment)))) {
                    loanPaymentError();
                }   
                else if(is_loan_error)
                    loanPaymentError(); 
                else {
                    noLoanPaymentError();
                }
                // if((college_loans_payment != 0 && loans_payment != 0) || ((college_loans_payment + loans_payment) > (money + net_earnings))) {
                //     loanPaymentError(true);
                //     loanPaymentError(false);
                // }
                // else {
                //     noLoanPaymentError(true, true);
                // }
            }

        function loanPaymentError() {
            document.getElementById("pay-loans").setAttribute('style', 'border: red solid 3px;');
            document.getElementById('pay-button').disabled = true;
        }

        function noLoanPaymentError() {
            document.getElementById("pay-loans").setAttribute('style', 'border: black solid 2px;');
            document.getElementById('pay-button').disabled = false;
        }

        cur_age = parseFloat("{{ player_info.age }}");
        need_loan = "{{ player_info.need_loan }}";
        turn_num = parseFloat("{{ player_info.turn_num }}");
        if((cur_age == 65) || (need_loan.toLowerCase() == "true") || (turn_num == -1)) {  // game over or force to get loan or game not started
            document.querySelectorAll('button').forEach(btn => {
                btn.disabled = true;
            });
        }

        home_ins = "{{ player_info.have_home_ins }}".toLowerCase() == "true" ? true : false;
        if(home_ins) // currently have home insurance
            document.getElementById("test-home-ins-checkbox").checked = true;

        auto_ins = "{{ player_info.have_auto_ins }}".toLowerCase() == "true" ? true : false;
        if(auto_ins) // currently have auto insurance
            document.getElementById("test-auto-ins-checkbox").checked = true;

        health_ins = "{{ player_info.have_health_ins }}".toLowerCase() == "true" ? true : false;
        if(health_ins) // currently have health insurance
            document.getElementById("test-health-ins-checkbox").checked = true;
        
        married = "{{ player_info.married }}".toLowerCase() == "true" ? true : false;
        if(married) // currently have health insurance
                document.getElementById("test-married-checkbox").checked = true;

        benefits = "{{ my_benefits }}".toLowerCase() == "true" ? true : false;
        if(benefits) // currently have health insurance
                document.getElementById("test-benefits-checkbox").checked = true;
        
        function updateTestOptions() {
            cur_home = "{{ player_info.house }}";
            test_home = document.getElementById("house").value;
            if((['Teepee', 'Tent', 'None', 'Igloo', 'Hut', 'Tree House', 'Studio'].includes(test_home)))  // can't get insurance for no home
                document.getElementById("test-home-ins-checkbox").disabled = true;
            else if((test_home == cur_home) && home_ins) {
                document.getElementById("test-home-ins-checkbox").disabled = false;
                document.getElementById("test-home-ins-checkbox").checked = true;
            }
            else
                document.getElementById("test-home-ins-checkbox").disabled = false;

            cur_car = "{{ player_info.car }}";
            test_car = document.getElementById("car").value;
            if((['Bike', 'Skateboard', 'None', 'Public Transit'].includes(test_car)))   // can't get insurance for no car
                document.getElementById("test-auto-ins-checkbox").disabled = true;
            else if((test_car == cur_car) && auto_ins) {
                document.getElementById("test-auto-ins-checkbox").disabled = false;
                document.getElementById("test-auto-ins-checkbox").checked = true;
            }
            else    
                document.getElementById("test-auto-ins-checkbox").disabled = false;
            }

        end_of_year = "{{ player_info.end_of_year }}".toLowerCase() == "true" ? true : false;
        if(!end_of_year) {
            document.getElementById('pay-button').disabled = true;
        }
    </script>
{% endblock %}
